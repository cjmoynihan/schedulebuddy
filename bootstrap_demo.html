<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
		
		<title>Hello, world!</title>
	</head>
	<body>
		
		<h1>Hello, world!</h1>

		<div class="row">
			<div class="col-sm-8">
				<h3>Schedule</h3>
				<canvas id="calendarCanvas" width="1400" height="1200"></canvas> 
			</div>
			
			<div class="col-sm-4" id="friendPicker">
				<h3>Add Friend Schedules</h3>
				<div class="checkbox">
					<label><input type="checkbox" value="1">Friend 1</label>
				</div>
				<div class="checkbox">
					<label><input type="checkbox" value="2">Friend 2</label>
				</div>
				<div class="checkbox">
					<label><input type="checkbox" value="3">Friend 3</label>
				</div>
				<div class="checkbox">
					<label><input type="checkbox" value="4">Friend 4</label>
				</div>
			</div>
		</div>
		
		<div class="row">
			<div class="col-lg-12">
				<h3>Add Event</h3>
			</div>
		</div>
		
		<form class="form-inline">
			<div class="form-group">
				<label for="event_name">Name:</label>
				<input type="text" class="form-control" id="eventNameInput">
			</div>
			
			<!--
			<div class="form-group">
				<label for="event_time">Start Time:</label>
				<input type="time" class="form-control" id="start_time">
			</div>
			-->
		</div>
		</form>
		
		<div class="row">
			<div class="col-lg-12">
				Start Time:
				<input type="time" id="startTimeInput">
			</div>
		</div>
		
		<div class="row">
			<div class="col-lg-12">
				End Time:
				<input type="time" id="endTimeInput">
			</div>
		</div>
		
		<select class="form-control" id="dayInput">
			<option value="0">Monday</option>
			<option value="1">Tuesday</option>
			<option value="2">Wednesday</option>
			<option value="3">Thursday</option>
			<option value="4">Friday</option>
			<option value="5">Saturday</option>
			<option value="6">Sunday</option>
		</select>
		
		<div class="row">
			<div class="col-lg-12">
				Repeat Every:
			</div>
		</div>
		
		<div class="row">
			<div class="col-lg-12">
				<label class="checkbox-inline" id="repeatMon"><input type="checkbox" value="0">Mon</label>
				<label class="checkbox-inline" id="repeatTue"><input type="checkbox" value="1">Tues</label>
				<label class="checkbox-inline" id="repeatWed"><input type="checkbox" value="2">Wed</label> 
				<label class="checkbox-inline" id="repeatThu"><input type="checkbox" value="3">Thurs</label>
				<label class="checkbox-inline" id="repeatFri"><input type="checkbox" value="4">Fri</label>
				<label class="checkbox-inline" id="repeatSat"><input type="checkbox" value="5">Sat</label> 
				<label class="checkbox-inline" id="repeatSun"><input type="checkbox" value="6">Sun</label>
			</div>
		</div>
		
		<button type="button" class="btn btn-primary" id="submit_event_btn">Create</button>
	</body>
	
	<script>
	// canvas where calendar is drawn
	var canvas = document.getElementById("calendarCanvas");
	var ctx = canvas.getContext("2d");
	
	// list of Event objects, which will be drawn to the calendar
	var events = [];
	
	var new_event_btn = document.getElementById("submit_event_btn");
	
	// create event from entered info when user clicks submit button
	new_event_btn.onclick = function() {
		// extract fields
		var event_name = document.getElementById("eventNameInput").value;
		var start_time = document.getElementById("startTimeInput").value;
		var end_time = document.getElementById("endTimeInput").value;
		var day = document.getElementById("dayInput").value;
		
		// make sure user entered info for each field
		if (event_name === "") {
			alert("Please Enter Event Name");
		}
		else if (start_time === "") {
			alert("Please Enter Start Time");
		}
		else if (end_time === "") {
			alert("Please Enter End Time");
		}
		else {
			// parse day, start, end times from input fields and createEvent()
			var day = parseInt(day);
			
			var start_hour = parseInt(start_time.substring(0, start_time.indexOf(":")));
			var start_min = parseInt(start_time.substring(start_time.indexOf(":") + 1, start_time.length));
			
			var end_hour = parseInt(end_time.substring(0, end_time.indexOf(":")));
			var end_min = parseInt(end_time.substring(end_time.indexOf(":") + 1, end_time.length));
			
			addEvent(event_name, '#00F0F0', day, start_hour, start_min, end_hour, end_min);
		}
	};
	
	function addEvent(name, color, day, startTimeHr, startTimeMin, endTimeHr, endTimeMin) {
		alert("Creating event: " + name + " " + color + " " + day + " " + startTimeHr + ":" + startTimeMin + " to " + endTimeHr + ":" + endTimeMin);
		// construct object
		var event = {
				name: name,
				color: '#00F0F0',
				day: day,
				startHour: startTimeHr,
				startMin: startTimeMin,
				endHour: endTimeHr,
				endMin: endTimeMin
			};
		// TODO: CHECK FOR INTERSECTS
		
		events.push(event);
		drawCalendar();
	}
	
	drawCalendar();
	
	// 
	function drawEvent(name, color, day, startTimeHr, startTimeMin, endTimeHr, endTimeMin) {
		var box_x = day * (canvas.width / 7);
		var box_y = canvas.height / 24.0 * startTimeHr + canvas.height / 1440.0 * startTimeMin;
		var box_width = canvas.width / 7;
		var box_height = canvas.height / 24.0 * (endTimeHr - startTimeHr) + canvas.height / 1440.0 * (endTimeMin - startTimeMin);
		
		// draw box
		ctx.fillStyle = color;
		ctx.fillRect(box_x, box_y, box_width, box_height);
		
		// draw event name centered 
		var font_size = 30;
		ctx.font = font_size + "px Arial";
		ctx.fillStyle = '#000000';
		ctx.fillText(name, box_x, box_y + font_size);
		ctx.fillText(startTimeHr + ':' + startTimeMin + ' - ' + endTimeHr + ":" + endTimeMin, box_x, box_y + 2 * font_size);
	}
	
	function drawCalendar() {
		var day_width = canvas.width / 7;
		var hour_height = canvas.height / 24;
		
		// draw vertical grid lines
		ctx.fillStyle = '#000000';
		for (var i = 0; i < 24; i++) {
			ctx.moveTo(0, i * hour_height);
			ctx.lineTo(canvas.width, i * hour_height);
			ctx.stroke();
		}
		
		
		
		ctx.fillStyle = '#000000';
		// draw lines separating days
		for (var i = 0; i < 8; i++) {
			ctx.moveTo(i * day_width, 0);
			ctx.lineTo(i * day_width, canvas.width);
			ctx.stroke(); 
		}
		
		drawEvent('Practice', '#FF0000', 2, 5, 15, 7, 15);
		drawEvent('Homework', '#00FF00', 3, 10, 30, 12, 30);
		drawEvent('Lunch', '#0000FF', 3, 12, 45, 13, 30);
	}
	</script>
</html>